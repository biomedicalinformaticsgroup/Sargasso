#!/usr/bin/env bash

set -o nounset
set -o errexit
set -o xtrace

SEQUENCE_FASTA_FILE=$1
NUM_THREADS=$2
INDEX_DIR=$3
BISULFITE_BUILD_EXECUTABLE=$4

function list_files {
    local DELIMITER=$1
    shift
    local FILES=$@
        
    LIST=$(ls -1 ${FILES} | tr '\n' "$DELIMITER")
    echo ${LIST%$DELIMITER}    
}

# bismark require the .fa and the output index under the same directory, thus link the .fa first

ln -s ${SEQUENCE_FASTA_FILE} ${INDEX_DIR}

${BISULFITE_BUILD_EXECUTABLE} --bowtie2 --parallel ${NUM_THREADS} ${INDEX_DIR}



